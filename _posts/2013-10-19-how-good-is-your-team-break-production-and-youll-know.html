---
layout: post
title: How good is your team? Break production and you'll know!
date: 2013-10-19 21:29:33.000000000 +00:00
categories:
- Continuous Deployment
- Fun at work
tags: []
status: publish
type: post
published: true
meta:
  _publicize_pending: '1'
  _knews_automated: '0'
author:
  login: maxhorstmann
  email: max.horstmann@gmail.com
  display_name: Max
  first_name: ''
  last_name: ''
---
<p>[caption id="attachment_135" align="alignright" width="300"]<img class="size-medium wp-image-135 " style="line-height:24px;" alt="amazon down" src="assets/amazon-down.jpg?w=300" width="300" height="205" /> Earlier this year. Somebody is having regrets right now...[/caption]</p>
<p><span style="font-size:1rem;line-height:1.714285714;">If you're a developer on a team running an online-service, the day will come where you </span><em style="font-size:1rem;line-height:1.714285714;">break production</em><span style="font-size:1rem;line-height:1.714285714;">. Not just the build. Not some automated tests. Not the development or staging environment. You will break the real thing that's out there and used by customers.</span></p>
<p>Why? Because no matter how many layers of safeguards and process you apply, no matter how thorough your QA team (if existent) works - you still can't predict the future. You'll never know the exact sequence of bits flowing from clients to servers, from datastores to business tiers to front-ends.</p>
<h3>Move fast and break things - not only at Facebook</h3>
<p>At <a href="http://stackexchange.com/">Stack Exchange</a>, we rely on a variety of safeguards to keep the <a href="http://careers.stackoverflow.com/">Careers 2.0</a> site up and running, such as unit tests, integration tests, UI tests and <a href="http://mattjibson.com/blog/2013/06/11/perceptual-diffs-at-stack-overflow/">perceptual diffs</a>. Shipping a change to production is fully automated, but it requires all these tests to pass first. So, as a developer I can ship quickly and as often as I want (<a href="http://maxhorstmann.net/2013/09/28/shipping-five-times-a-day/">which is fun</a>) while still being protected to some degree from destroying our live site with the click of a button.</p>
<p>[caption id="attachment_140" align="alignleft" width="300"]<a href="http://maxhorstmann.net/wp-content/uploads/2013/10/readytoship.png"><img class="size-medium wp-image-140 " alt="readyToShip" src="assets/readytoship.png?w=300" width="300" height="98" /></a> All tests have passed? Clicking the last "build" button will deploy to production. Note: no sign-off meetings needed.[/caption]</p>
<p>Still, a few months back, I managed to break production. Here's how: I checked in a database script which worked locally and on our dev environment, but then threw an error in production due to a difference in data. As said: atoms - universe - not can predict..</p>
<p><span style="line-height:1.714285714;font-size:1rem;">By the way - even if a production build fails, it doesn't necessarily mean that the entire site is broken from a user's perspective. Let's say we're currently running version <em>n </em>and kick off the build to deploy version <em>n+1</em>. In case of a deployment failure, we would ideally expect a clean rollback to version <em>n</em>. Well, what happened in this particular case was: my change got bundled up with a few others, includig a set of database migrations. And of course my db migrations failed after previous migrations, authored by someone else on my team, have already succeded. So, the database was basically now somwhere in state "<em>n+0.5"</em>, while the web tier was still running version <em>n</em>. This inconsistency turned out to be fatal.</span></p>
<h3>We need to talk</h3>
<p><span style="font-size:1rem;line-height:1.714285714;">The day you break production might be a stressful one for you personally. But the goo</span><span style="font-size:1rem;line-height:1.714285714;">d news is, It's also a day you'll to find out what kind of team you're on. If you get the opportunity to fix the problem, apologize for your mistake, and (ideally) take some steps to prevent the same type of failure from happening again, you're on a good team. Someone might still yell at you in the heat of the moment. Don't take it personally - the consequences are potentially huge if your site is down. Your company might be losing money with every minute of downtime. News about your failure might already be spreading on social media. Pressure is on.</span></p>
<p>Quite different story though if you find yourself reporting to <a href="http://www.imdb.com/title/tt0151804/quotes?item=qt0386861">eight different bosses</a> after the incident, with fingers pointed at you all over the place. In case you're part of a post-mortem discussion, pay close attention: those can be incredibly useful and constructive, and also a gigantic waste of time.</p>
<p>If you're on that last team, run. Not only because chances are you didn't enjoy getting yelled at that much. But much more importantly, in the long run you'll find the entire team exercising <strong>risk aversion</strong>. If everyone's scared to death of getting hassled (or fired) after breaking something, they will try to make sure that won't happen - but at a high cost: be prepared for long sign-off meetings, senseless <a href="http://en.wikipedia.org/wiki/Cover_your_ass">CYA</a> email threads, and the blame game to already start before a single bit has been shipped. In extreme cases, it'll take anywhere between forever and eternity to get anything done.</p>
<h3>Well, now that being said...</h3>
<p>Of course, you can't be expect your team to be very forgiving if you do any of the following:</p>
<ul>
<li>deliberately circumvent existing rules and procedures</li>
<li>try to cover up your mistake</li>
<li>make the same mistake several times</li>
<li><span style="line-height:1.714285714;font-size:1rem;">refuse to take accountability</span></li>
<li>generally signal that you don't care that much</li>
</ul>
<p>Ever worked with people who do that? It's basically the dark side of "you should be allowed to break stuff".  If you find yourself in an environment where this kind of behavior is tolerated, you also better run fast - before assimilation sets in.</p>
<h3>Won't happen again!</h3>
<p><span style="line-height:1.714285714;font-size:1rem;">In the case of my failed database migration, I ended up improving our internal migrator tool, so all database migrations are now by default wrapped in a global transaction. No failed migration scripts have brought our site down since then - yay! </span></p>
<p><span style="line-height:1.714285714;font-size:1rem;">So, how good is your team? If you don't know now, don't worry. You'll find out.</span></p>
